<!DOCTYPE html>
<html>
<head>
    <title>Alpha 5.0 Flag Parser Test</title>
    <style>
        body { font-family: monospace; padding: 20px; background: #1a1a1a; color: #fff; }
        .test { margin: 20px 0; padding: 10px; border: 1px solid #444; }
        .pass { background: #1a4d1a; }
        .fail { background: #4d1a1a; }
        pre { background: #000; padding: 10px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>Testing Alpha 5.0 Parser with Existing Flags</h1>

    <div id="results"></div>

    <script type="module">
        import { FlagSet } from './scripts/flags_v5.js';

        const results = document.getElementById('results');

        function runTest(name, flagString, checks) {
            const div = document.createElement('div');
            div.className = 'test';

            try {
                const fs = new FlagSet();
                fs.load(flagString);

                let allPassed = true;
                let output = `<h3>${name}</h3>`;
                output += `<pre>Flags: ${flagString}</pre>`;
                output += `<pre>Parsed flags:\n`;

                const allFlags = fs.get_list();
                output += JSON.stringify(allFlags, null, 2);
                output += `\n\nChecks:\n`;

                for (const check of checks) {
                    const result = check.test(fs);
                    const status = result ? '✓ PASS' : '✗ FAIL';
                    output += `${status}: ${check.description}\n`;
                    if (!result) allPassed = false;
                }

                output += `</pre>`;
                div.innerHTML = output;
                div.classList.add(allPassed ? 'pass' : 'fail');

            } catch (e) {
                div.innerHTML = `<h3>${name}</h3><pre>ERROR: ${e.message}\n${e.stack}</pre>`;
                div.classList.add('fail');
            }

            results.appendChild(div);
        }

        // Test 1: Standard FE 4.6.X flags
        runTest('Standard FE 4.6.X Flags',
            'Kmain Pkey Cstandard Tvanilla Bnone',
            [
                { description: 'Has Kmain', test: fs => fs.has('Kmain') },
                { description: 'Has Pkey', test: fs => fs.has('Pkey') },
                { description: 'Has Cstandard', test: fs => fs.has('Cstandard') },
                { description: 'Has Tvanilla', test: fs => fs.has('Tvanilla') },
                { description: 'Has Bnone', test: fs => fs.has('Bnone') }
            ]
        );

        // Test 2: Galeswift Boss Collector
        runTest('Galeswift Boss Collector',
            'Omode:bosscollector O1:boss_bahamut O2:boss_cpu Oreq:2 Kmain Pkey Cstandard',
            [
                { description: 'Has Omode:bosscollector', test: fs => fs.has('Omode:bosscollector') },
                { description: 'Has O1:boss_bahamut', test: fs => fs.has('O1:boss_bahamut') },
                { description: 'Has O2:boss_cpu', test: fs => fs.has('O2:boss_cpu') },
                { description: 'Has Oreq:2', test: fs => fs.has('Oreq:2') },
                { description: 'Has Kmain', test: fs => fs.has('Kmain') }
            ]
        );

        // Test 3: Galeswift Gold Hunter
        runTest('Galeswift Gold Hunter',
            'Omode:goldhunter Oreq:1 Kmain Pkey Cstandard',
            [
                { description: 'Has Omode:goldhunter', test: fs => fs.has('Omode:goldhunter') },
                { description: 'Has Oreq:1', test: fs => fs.has('Oreq:1') },
                { description: 'Has Kmain', test: fs => fs.has('Kmain') }
            ]
        );

        // Test 4: Alpha Objective Groups
        runTest('Alpha Objective Groups',
            'OA1:quest_cavebahamut/2:quest_traderat/3:boss_bahamut/4:boss_wyvern/do_all:game OB1:collect_boss1/2:collect_boss2/3:collect_boss5/do_1:siren/do_2:siren/do_all:siren Kmain Pkey Cstandard',
            [
                { description: 'Has OA1:quest_cavebahamut', test: fs => fs.has('OA1:quest_cavebahamut') },
                { description: 'Has OA2:quest_traderat', test: fs => fs.has('OA2:quest_traderat') },
                { description: 'Has OA3:boss_bahamut', test: fs => fs.has('OA3:boss_bahamut') },
                { description: 'Has OA4:boss_wyvern', test: fs => fs.has('OA4:boss_wyvern') },
                { description: 'Has OAdo_all:game', test: fs => fs.has('OAdo_all:game') },
                { description: 'Has OB1:collect_boss1', test: fs => fs.has('OB1:collect_boss1') },
                { description: 'Has OBdo_1:siren', test: fs => fs.has('OBdo_1:siren') }
            ]
        );

        // Test 5: Alpha 5.0 Dark Matter Quest Mode
        runTest('Alpha 5.0 Dark Matter Quest',
            'Omode_dkmatter:quests Owin:crystal Kmain Pkey Cstandard',
            [
                { description: 'Has Omode_dkmatter:quests', test: fs => fs.has('Omode_dkmatter:quests') },
                { description: 'Has Owin:crystal', test: fs => fs.has('Owin:crystal') },
                { description: 'Has Kmain', test: fs => fs.has('Kmain') }
            ]
        );

    </script>
</body>
</html>
